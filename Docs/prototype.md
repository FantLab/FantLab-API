# Прототип API

## Замечания
1. Домен для запросов - http://dev3.fantlab.org:4242/
2. Поддерживается 2 варианта выдачи: `JSON` (по-умолчанию) и `Protobuf`. Для использования последнего необходимо добавить хэдер `Accept: application/x-protobuf`.
3. В выдаче `JSON` отсутствуют поля, если их значение совпадает с дефолтным (0 для int, пустая строка для строк etc). Это ограничение `Protobuf`.
4. Некоторые поля имеют сложносоставленное название (например, `topic_type`). Это сделано специально, чтобы избежать коллизий с зарезервированными словами из Java/Kotlin/Swift при генерации моделей через рефлексию.
5. Тип поля DateTime имеет разное значение в `JSON` и `Protobuf`. В первом случае это строка в формате `{год}-{месяц}-{день}T{часов}:{минут}:{секунд}Z` ([RFC 3339](https://www.ietf.org/rfc/rfc3339.txt)), во втором - UNIX-таймштамп.

## Содержание
1. Авторизация
    * Логин
2. Форумы
    * Список форумов
    * Форум
    * Тема
3. Блоги
    * Список рубрик
    * Список авторских колонок
    * Авторская колонка

## Форумы
### Список форумов
Запрос
```
GET /v1/forums
```
Ответ
```
{
    forum_blocks:[                                 # список блоков форумов
        {
            id: Int,                               # id блока форумов
            title: String,                         # название блока форумов
            forums:[                               # список форумов
                {
                    id: Int,                       # id форума
                    title: String,                 # название форума
                    forum_description: String,     # описание форума
                    moderators:[                   # список модераторов форума
                        {
                            id: Int,               # id модератора (как пользователя)
                            login: String          # логин модератора
                        },
                        ...
                    ],
                    stats: {                       # статистика форума
                        topic_count: Int,          # количество тем в форуме
                        message_count: Int         # количество сообщений в форуме
                    },
                    last_message: {                # последнее сообщение в форуме
                        id: Int,                   # id сообщения
                        topic: {                   # тема последнего сообщения
                            id: Int,               # id темы
                            title: String          # название темы
                        },
                        user: {                    # автор сообщения
                            id: Int,               # id пользователя
                            login: String          # логин пользователя
                        },
                        date: DateTime             # дата и время сообщения
                    }
                },
                ...
            ]
        },
        ...
    ]
}
```

### Форум
Запрос
```
GET /v1/forums/{id}?page={page}&limit={limit}
```
Параметры
```
id - id форума
page - номер страницы
limit - количество тем на одной странице (необязательный, по-умолчанию 20)
```
Ответ
```
{
    topics:[                               # список тем
        {
            id: Int,                       # id темы
            title: String,                 # название темы
            topic_type: String,            # тип темы (TOPIC (тема) или POLL (опрос))
            creation: {                    # данные о создании
                user: {                    # автор
                    id: Int,               # id пользователя
                    login: String          # логин пользователя
                },
                date: DateTime             # дата и время создания
            },
            is_closed: Boolean,            # тема закрыта?
            is_pinned: Boolean,            # тема закреплена?
            stats: {                       # статистика темы
                message_count: Int,        # количество сообщений
                views_count: Int           # количество просмотров
            },
            last_message: {                # последнее сообщение в теме
                id: Int,                   # id сообщения
                user: {                    # автор сообщения
                    id: Int,               # id пользователя
                    login: String          # логин пользователя
                },
                date: DateTime             # дата и время сообщения
            }
        },
        ...
    ]
}
```
Возможные ошибки
```
Некорректный id форума
{
    error_code: 400,
    message: "incorrect forum id: {id}"
}

Некорректный номер страницы
{
    error_code: 400,
    message: "incorrect page: {page}"
}

Некорректный лимит
{
    error_code: 400,
    message: "incorrect limit: {limit}"
}
```

### Тема
Запрос
```
GET /v1/topics/{id}?page={page}&limit=${limit}
```
Параметры
```
id - id темы
page - номер страницы
limit - лимит сообщений в теме (необязательный, по-умолчанию 20)
```
Ответ
```
{
    messages:[                              # список сообщений в теме
        {
            id: Int,                        # id сообщения
            creation: {                     # данные о создании
                user: {                     # автор сообщения
                    id: Int,                # id пользователя
                    login: String,          # логин пользователя
                    gender: String,         # пол пользователя (MALE или FEMALE)
                    avatar: String,         # ссылка на аватар пользователя
                    class: Int              # класс пользователя
                },
                date: DateTime              # дата и время отправки сообщения
            },
            text: String,                   # текст сообщения
            stats: {                        # статистика сообщения
                plus_count: Int,            # количество плюсов
                minus_count: Int            # количество минусов
            }
        },
        ...
    ]
}
```
Возможные ошибки
```
Некорректный id темы
{
    error_code: 400,
    message: "incorrect topic id: {id}"
}

Некорректный номер страницы
{
    error_code: 400,
    message: "incorrect page: {page}"
}

Некорректный лимит
{
    error_code: 400,
    message: "incorrect limit: {limit}"
}
```
