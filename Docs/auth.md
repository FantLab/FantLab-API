# Авторизация

## Основная авторизация
Запрос
```
POST /login
```

Параметры
```
login - логин пользователя
password - пароль пользователя
```

Ответ
```
# при успешной авторизации
{ 
   auth: Boolean,                     # состояние авторизации юзера на сайте (да/нет), 1 - при успешной авторизации
   user_id: Int,                      # id юзера
   user_login: String,                # логин юзера
   X-Session: String,                 # код сессии (например: "Z5RrvohMG2v56xph"),
}

# при неудаче
{
   auth: Boolean,                     # 0 - при отсутствии авторизации
   error_msg: Int,                    # сообщение о причине отказа в авторизации
}
```

При успешной авторизации будет выдан уникальный код сессии (токен) X-Session, который нужно будет добавлять в хедер при запросах к авторизованным ресурсам сайта. (В запросах к json общего доступа, без авторизации, этот хиддер игнорируется)

_**Примечание**: Проведение авторизации с логином и паролем только по POST-запросу. По GET-запросу к этому же урлу параметры login и password не обрабатываются!_



## Статус авторизации

Запрос
```
GET /login
```

Параметры
```
Заголовок *X-Session* (или кук *fl_s*) содержащий значение уникального кода авторизированной сессии.
```

Пример
> [/login](https://api.fantlab.ru/login) - текущий статус авторизации на ФЛ (ваш)

Ответ
```
{
   auth: Boolean,                     # состояние авторизации юзера на сайте (да/нет)
}
```
_Примечание: в состоянии авторизации дополнительно отдаются поля `user_id`, `user_login` и `X-Session` (как в примере овтета на POST выше)._



### Через cookie (альтернативный способ)

Также - при успешной авторизации `POST /login` отдается хэдер *Set-Cookie* с куком *fl_s*. Если он отсутствует, значит, авторизация не удалась. (Значения куки fl_s и X-Session в json - одинаковы)
Пример:
```
Set-Cookie: fl_s=Z5RrvohMG2v56xph; expires=Mon, 30 Jul 2018 06:46:11 GMT; domain=.fantlab.ru;
```
Срок валидности данного кука равен 1 году. Для подписи запросов следует подставлять его в хэдер _Cookie_. В данном случае
```
fl_s=Z5RrvohMG2v56xph
```

**Примечания про работы с cookie в Android:** При авторизации следует отключить автоматический редирект в HttpClient'е, иначе произойдет перенаправление на главную сайта, а там хэдера _Set-Cookie_ уже нет. В _Retrofit_ это можно сделать при первоначальном конфигурировании:
```java
httpClientBuilder.setFollowRedirects(false)
```
В _Fuel_ чуть сложнее:
```kotlin
FuelManager.instance.apply {
    removeAllResponseInterceptors()
    addResponseInterceptor(validatorResponseInterceptor(200..299))
}
```
